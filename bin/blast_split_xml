#! /bin/bash
#
#  Use the cool xml_split tool to split large BLAST result sets
#  as generated by the -m7 switch. xml_split does not load the
#  full DOM tree in memory, so any size file can be split.
#
#  xml_split is part of XML-Twig - see http://xmltwig.com/. This
#  script does the housekeeping...
#
#  By Pjotr Prins (c) 2009
#  See the biotools LICENSE file

for fn in $* ; do
	echo Splitting $fn ...
	# ---- Split every iteration into a file
  xml_split -e .iter -c Iteration $fn
	for ifn in *.iter ; do
	  # ---- Add the BLAST xml header and footer, so it can be parsed
		#      by most parsers (like Bio::Blast in BioRuby)
	  ixmlfn=$ifn.xml
  	head -20 $fn > $ixmlfn
		cat $ifn >> $ixmlfn
	  tail -2 $fn >> $ixmlfn
  done
	# ---- Cleanup
	rm *00.iter.xml
	rm *.iter
done

